<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scoring Rules for GEE â€¢ cvGEE</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Scoring Rules for GEE">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cvGEE</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Scoring_Rules_GEE.html">Scoring Rules for GEE</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/drizopoulos/cvGEE">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Scoring Rules for GEE</h1>
                        <h4 class="author">Dimitris Rizopoulos</h4>
            
            <h4 class="date">2019-07-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/drizopoulos/cvGEE/blob/master/vignettes/Scoring_Rules_GEE.Rmd"><code>vignettes/Scoring_Rules_GEE.Rmd</code></a></small>
      <div class="hidden name"><code>Scoring_Rules_GEE.Rmd</code></div>

    </div>

    
    
<div id="scoring-rules" class="section level2">
<h2 class="hasAnchor">
<a href="#scoring-rules" class="anchor"></a>Scoring Rules</h2>
<p>We present here a short introduction into proper scoring rules. Let <span class="math inline">\(Y_{ij}\)</span> denote a categorical outcome taking values in the set <span class="math inline">\(\{0, 1, \ldots, K\}\)</span> for sample unit <span class="math inline">\(i\)</span> in cluster/group <span class="math inline">\(j\)</span>; <span class="math inline">\(K\)</span> can be finite (e.g., number of Bernoulli experiments) or infinite (count data). We let also <span class="math inline">\(\pi_{ijk} = \Pr(Y_{ij} = k)\)</span>, <span class="math inline">\(k = 1, \ldots, K\)</span>. A scoring rule <span class="math inline">\(R(\pi_{ij}, \{Y_{ij} = k\})\)</span> is a function that assigns a score for the forecast <span class="math inline">\(\{\pi_{ijk}; k = 1, \ldots, K\}\)</span> upon observing the outcome <span class="math inline">\(\{Y_{ij} = k\}\)</span>. That is, based on observing <span class="math inline">\(Y_{ij}\)</span>, we get probabilities for all <span class="math inline">\(K\)</span> categories. A proper scoring rule is rule that is maximized when the true probabilities are used in its calculation. The best-known proper scoring rules, together with their score ranges are: <span class="math display">\[\begin{array}{rl}
\mbox{logarithmic:} &amp; R(\pi_{ij}, \{Y_{ij} = k\}) = \log(\pi_{ijk}), \quad (-\infty, 0],\\\\
\mbox{quadratic:} &amp; R(\pi_{ij}, \{Y_{ij} = k\}) = 2\pi_{ijk} - \sum_{\ell = 1}^K \pi_{ij\ell}^2, \quad [-1, 1],\\\\
\mbox{spherical:} &amp; R(\pi_{ij}, \{Y_{ij} = k\}) = \pi_{ijk} \Bigg / \sqrt{\sum_{\ell = 1}^K \pi_{ij\ell}^2}, \quad [0, 1].\\
\end{array}\]</span> The quadratic and spherical scoring rules often result in extreme ranking differences when compared to the logarithmic scoring rule. Furthermore, due to being non-local, the quadratic and spherical scoring rules allow for the possibility of one model receiving the highest score when assigning a probability to the observed outcome lower than the probabilities assigned by other models.</p>
<p>However, in generalized estimating equations we make no specification of the distribution of the data apart from the first two moments. Therefore, we do not get a probability mass function to obtain <span class="math inline">\(\{\pi_{ijk}; k = 1, \ldots, K\}\)</span>. Hence, in the calculation behind <strong>cvGEE</strong> the following conventions are made.</p>
<ul>
<li><p>For dichotomous data (<span class="math inline">\(K = 1\)</span>) we use the Bernoulli distribution in the calculation of the scoring rules.</p></li>
<li><p>For binomial data and to account for over-dispersion we use the Beta-Binomial distribution. From the quasi-likelihood behind the GEE the variance of <span class="math inline">\(Y_{ijk}\)</span> is <span class="math inline">\(\mbox{var}(Y_{ijk}) = \phi K \pi_{ijk} (1 - \pi_{ijk})\)</span>, where <span class="math inline">\(\phi\)</span> is the over-dispersion parameter. The scale parameter <span class="math inline">\(\theta\)</span> of the Beta-Binomial distribution is set equal to <span class="math inline">\((K - \phi) / (\phi - 1)\)</span>, such that the variance of Beta-Binomial matches the variance behind the quasi-likelihood.</p></li>
<li><p>For count data and to account for over-dispersion we use the negative binomial distribution. From the quasi-likelihood behind the GEE the variance of <span class="math inline">\(Y_{ij}\)</span> is <span class="math inline">\(\mbox{var}(Y_{ij}) = \phi \mu_{ij}\)</span>, where <span class="math inline">\(\phi\)</span> is the over-dispersion parameter and <span class="math inline">\(\mu_{ij} = E(Y_{ij})\)</span>. The shape parameter <span class="math inline">\(\theta\)</span> of the negative-binomial distribution is set equal to <span class="math inline">\(\mu_{ij} / (\phi - 1)\)</span>, such that the variance of negative-binomial matches the variance behind the quasi-likelihood.</p></li>
</ul>
</div>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h2>
<div id="two-non-linear-models" class="section level3">
<h3 class="hasAnchor">
<a href="#two-non-linear-models" class="anchor"></a>Two non-linear models</h3>
<p>For our first example we consider a dichotomized version of the serum cholesterol biomarker from the PBC dataset, taking as cut-off the value of 210 mg/dL. This a longitudinal dataset in which we have repeated measurements of serum cholesterol during follow-up for the patients randomized in the trial. The <code>id</code> variable identifies measurements taken on the same patient. We would like to investigate the placing of the knots in a natural cubic spline for the follow-up times for the log-odds of high serum cholesterol levels. In the first GEE we place two knots at the median and third quantile (the first quantile is equal to the boundary knot at zero). In the second GEE we place the knots at two, five and seven years of follow-up. The working correlation matrix is assumed to be the exchangeable one. We solve the two GEEs using the following calls to <code>geeglm()</code> from package <strong>geepack</strong>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">pbc2<span class="op">$</span>serCholD &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(pbc2<span class="op">$</span>serChol <span class="op">&gt;</span><span class="st"> </span><span class="dv">210</span>)</a>
<a class="sourceLine" id="cb1-2" title="2">gm1 &lt;-<span class="st"> </span><span class="kw">geeglm</span>(serCholD <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(year, <span class="dt">knots =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">3</span>, <span class="dv">6</span>), <span class="dt">Boundary.knots =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="op">*</span><span class="st"> </span>drug, </a>
<a class="sourceLine" id="cb1-3" title="3">              <span class="dt">family =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/family">binomial</a></span>(), <span class="dt">data =</span> pbc2, <span class="dt">id =</span> id, </a>
<a class="sourceLine" id="cb1-4" title="4">              <span class="dt">corstr =</span> <span class="st">"exchangeable"</span>)</a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6">gm2 &lt;-<span class="st"> </span><span class="kw">geeglm</span>(serCholD <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(year, <span class="dt">knots =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">7</span>), <span class="dt">Boundary.knots =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="op">*</span><span class="st"> </span>drug, </a>
<a class="sourceLine" id="cb1-7" title="7">              <span class="dt">family =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/family">binomial</a></span>(), <span class="dt">data =</span> pbc2, <span class="dt">id =</span> id, </a>
<a class="sourceLine" id="cb1-8" title="8">              <span class="dt">corstr =</span> <span class="st">"exchangeable"</span>)</a></code></pre></div>
<p>These GEEs are not nested and therefore we cannot compare them with a Wald test. Hence, we will use the proper scoring rules to investigate if there are differences between the splines. We calculate all scoring rules for each observation using the following calls to <code><a href="../reference/cv_gee.html">cv_gee()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">plot_data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cv_gee.html">cv_gee</a></span>(gm1, <span class="dt">return_data =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-2" title="2">plot_data<span class="op">$</span>non_linear_I &lt;-<span class="st"> </span>plot_data<span class="op">$</span>.score</a>
<a class="sourceLine" id="cb2-3" title="3">plot_data<span class="op">$</span>non_linear_II &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(<span class="kw"><a href="../reference/cv_gee.html">cv_gee</a></span>(gm2))</a></code></pre></div>
<p>In the first call for model <code>gm1</code> we specified that we want to return the calculated values for the scoring rules in the original dataset used to solve the GEE (excluding any missing values in the outcome or covariates). The column that is created by <code><a href="../reference/cv_gee.html">cv_gee()</a></code> and contains the values of the scoring rules is called <code>.score</code>. In the second line we make a copy of this column with the name <code>non_linear_I</code> that will be used in the plotting next. The third line calculates the scoring rules for the second GEE. In this one we have asked for the dataset, but rather only for the values of the scoring rules that are put in the column <code>non_linear_II</code> of the <code>plot_data</code>.</p>
<p>Next, to see if there are differences in predictive performance between the two GEEs we plot the three scoring rules for the two GEEs using the following call to <code>xyplot()</code> from package <strong>lattice</strong>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">xyplot</span>(non_linear_I <span class="op">+</span><span class="st"> </span>non_linear_II <span class="op">~</span><span class="st"> </span>year <span class="op">|</span><span class="st"> </span>.rule, <span class="dt">data =</span> plot_data, </a>
<a class="sourceLine" id="cb3-2" title="2">       <span class="dt">type =</span> <span class="st">"smooth"</span>, <span class="dt">auto.key =</span> <span class="ot">TRUE</span>, <span class="dt">layout =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">3</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb3-3" title="3">       <span class="dt">scales =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">y =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">relation =</span> <span class="st">"free"</span>)),</a>
<a class="sourceLine" id="cb3-4" title="4">       <span class="dt">xlab =</span> <span class="st">"Follow-up time (years)"</span>, <span class="dt">ylab =</span> <span class="st">"Scoring Rules"</span>)</a></code></pre></div>
<p><img src="Scoring_Rules_GEE_files/figure-html/plot_Ex1-1.png" width="816" style="display: block; margin: auto;"></p>
<p>We can make the following two observations. First, there are no differences between the two splines with regard to predictive ability. Second, that the predictive ability of both GEEs decreases over time.</p>
</div>
<div id="working-correlation-matrix" class="section level3">
<h3 class="hasAnchor">
<a href="#working-correlation-matrix" class="anchor"></a>Working correlation matrix</h3>
<p>For our second example we aim to use the proper scoring rules for selecting the working correlation matrix for the AIDS dataset. This is again a longitudinal study on patients with advanced HIV infection. The outcome of interest is the CD4 cell count. Because of the CD4 cell counts can be high, often this outcome is analyzed with a linear mixed model after a square root transformation. Here we respect the nature of the outcome, and analyze it as a count. In the <code>aids</code> data frame the <code>CD4</code> variable is the already square root transformed CD4 cell counts. Hence, as a first step we transform it to the original scale. For the mean structure we only include the follow-up time as a categorical variable. For the working correlation we solve the GEEs assuming the independence, exchangeable and AR1 structures (the data are already ordered with respect to follow-up time).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">aids<span class="op">$</span>CD4count &lt;-<span class="st"> </span>aids<span class="op">$</span>CD4 <span class="op">*</span><span class="st"> </span>aids<span class="op">$</span>CD4</a>
<a class="sourceLine" id="cb4-2" title="2">aids<span class="op">$</span>obstimef &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(aids<span class="op">$</span>obstime)</a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4">fm1 &lt;-<span class="st"> </span><span class="kw">geeglm</span>(CD4count <span class="op">~</span><span class="st"> </span>obstimef, <span class="dt">family =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/family">poisson</a></span>(), <span class="dt">data =</span> aids, </a>
<a class="sourceLine" id="cb4-5" title="5">              <span class="dt">id =</span> patient, <span class="dt">corstr =</span> <span class="st">"independence"</span>)</a>
<a class="sourceLine" id="cb4-6" title="6"></a>
<a class="sourceLine" id="cb4-7" title="7">fm2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/update">update</a></span>(fm1, <span class="dt">corstr =</span> <span class="st">"exchangeable"</span>)</a>
<a class="sourceLine" id="cb4-8" title="8"></a>
<a class="sourceLine" id="cb4-9" title="9">fm3 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/update">update</a></span>(fm1, <span class="dt">corstr =</span> <span class="st">"ar1"</span>)</a></code></pre></div>
<p>Using a similar syntax as in the previous example we create the <code>plot_data</code> dataset with the estimated values for the three scoring rules under the different working correlation structures. We set an upper bound in the maximum count to 1000 cells/<span class="math inline">\(\mu \mbox{l}\)</span>, which is in the middle of the normal range for this biomarker in healthy individuals. In our sample, the maximum was 582 cells/<span class="math inline">\(\mu \mbox{l}\)</span>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">plot_data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cv_gee.html">cv_gee</a></span>(fm1, <span class="dt">return_data =</span> <span class="ot">TRUE</span>, <span class="dt">max_count =</span> <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb5-2" title="2">plot_data<span class="op">$</span>independence &lt;-<span class="st"> </span>plot_data<span class="op">$</span>.score</a>
<a class="sourceLine" id="cb5-3" title="3">plot_data<span class="op">$</span>exchangeable &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(<span class="kw"><a href="../reference/cv_gee.html">cv_gee</a></span>(fm2, <span class="dt">max_count =</span> <span class="dv">1000</span>))</a>
<a class="sourceLine" id="cb5-4" title="4">plot_data<span class="op">$</span>ar1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(<span class="kw"><a href="../reference/cv_gee.html">cv_gee</a></span>(fm3, <span class="dt">max_count =</span> <span class="dv">1000</span>))</a></code></pre></div>
<p>And using a similar call to <code>xyplot()</code> we produce the plot of these values over the follow-up time:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">xyplot</span>(independence <span class="op">+</span><span class="st"> </span>exchangeable <span class="op">+</span><span class="st"> </span>ar1 <span class="op">~</span><span class="st"> </span>obstime <span class="op">|</span><span class="st"> </span>.rule, </a>
<a class="sourceLine" id="cb6-2" title="2">       <span class="dt">data =</span> plot_data, <span class="dt">type =</span> <span class="st">"smooth"</span>, <span class="dt">auto.key =</span> <span class="ot">TRUE</span>, <span class="dt">layout =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">3</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb6-3" title="3">       <span class="dt">scales =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">y =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">relation =</span> <span class="st">"free"</span>)),</a>
<a class="sourceLine" id="cb6-4" title="4">       <span class="dt">xlab =</span> <span class="st">"Follow-up time (months)"</span>, <span class="dt">ylab =</span> <span class="st">"Scoring Rules"</span>)</a></code></pre></div>
<p><img src="Scoring_Rules_GEE_files/figure-html/plot_Ex2-1.png" width="816" style="display: block; margin: auto;"></p>
<p>We observe that the independence working correlation matrix seems to produce the better predictions compared to the other two. Also we observe that the predictive performance of the three structures remains relatively stable during follow-up.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#scoring-rules">Scoring Rules</a></li>
      <li><a href="#examples">Examples</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://www.drizopoulos.com/">Dimitris Rizopoulos</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
